<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>Jest 20: 💖 Delightful Testing &amp; 🏃🏽 Multi-Project-Runner · Jest</title><meta name="viewport" content="width=device-width"/><meta property="og:title" content="Jest 20: 💖 Delightful Testing &amp; 🏃🏽 Multi-Project-Runner · Jest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/jest/blog/2017/05/06/jest-20-delightful-testing-multi-project-runner.html"/><meta property="og:description" content="A few months ago we announced [Jest 19](http://facebook.github.io/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html) which came with major new features and was the biggest Jest release until today. Jest 20 has twice the amount of changes compared to the previous version, features a complete rewrite of the test runner, adds new testing APIs. The new release enables a new level of customization and configuration for projects all while making it effortless to upgrade. Beyond Painless JavaScript Testing, we believe Jest is now delivering a **Delightful JavaScript Testing experience**. Let&#x27;s take a look at the best new features and changes in depth:"/><meta property="og:image" content="/jest/img/opengraph.png"/><link rel="shortcut icon" href="/jest/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="/jest/css/main.css"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img src="/jest/img/jest-outline.svg"/><h2>Jest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/en/getting-started.html" target="_self">Docs</a></li><li><a href="/jest/docs/en/api.html" target="_self">API</a></li><li><a href="/jest/en/help.html" target="_self">Help</a></li><li><a href="/jest/blog" target="_self">Blog</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/jest/img/language.svg"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/jest/ja">日本語</a></li><li><a href="/jest/es-ES">Español</a></li><li><a href="/jest/pt-BR">Português (Brasil)</a></li><li><a href="/jest/ru">Русский</a></li><li><a href="/jest/uk">Українська</a></li><li><a href="/jest/zh-Hans">简体中文</a></li><li><a href="https://crowdin.com/project/jest" target="_blank">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/facebook/jest" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Recent Posts</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Recent Posts</h3><ul><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/blog/2017/05/06/jest-20-delightful-testing-multi-project-runner.html">Jest 20: 💖 Delightful Testing &amp; 🏃🏽 Multi-Project-Runner</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html">🃏 Jest 19: Immersive Watch Mode &amp; Test Platform Improvements</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2017/01/30/a-great-developer-experience.html">A Great Developer Experience</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/12/15/2016-in-jest.html">2016 in Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/10/03/jest-16.html">Jest 16.0: Turbocharged CLI &amp; Community Update</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/09/01/jest-15.html">Jest 15.0: New Defaults for Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/07/27/jest-14.html">Jest 14.0: React Tree Snapshot Testing</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/06/22/jest-13.html">Jest 13.0: Flow &amp; REPL</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/04/12/jest-11.html">Jest 11.0</a></li><li class="navListItem"><a class="navItem" href="/jest/blog/2016/03/11/javascript-unit-testing-performance.html">JavaScript Unit Testing Performance</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer documentContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><div class="authorPhoto"><a href="http://twitter.com/cpojer" target="_blank"><img src="https://graph.facebook.com/100000023028168/picture/?height=200&amp;width=200"/></a></div><p class="post-authorName"><a href="http://twitter.com/cpojer" target="_blank">Christoph Pojer</a></p><h1><a href="/jest/blog/2017/05/06/jest-20-delightful-testing-multi-project-runner.html">Jest 20: 💖 Delightful Testing &amp; 🏃🏽 Multi-Project-Runner</a></h1><p class="post-meta">May 6, 2017</p></header><div><p>A few months ago we announced <a href="http://facebook.github.io/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html" target="_blank">Jest 19</a> which came with major new features and was the biggest Jest release until today. Jest 20 has twice the amount of changes compared to the previous version, features a complete rewrite of the test runner, adds new testing APIs. The new release enables a new level of customization and configuration for projects all while making it effortless to upgrade. Beyond Painless JavaScript Testing, we believe Jest is now delivering a <strong>Delightful JavaScript Testing experience</strong>. Let&#x27;s take a look at the best new features and changes in depth:</p><h2><a class="anchor" name="multi-project-runner-configuration-overhaul"></a>Multi-Project-Runner &amp; Configuration Overhaul <a class="hash-link" href="#multi-project-runner-configuration-overhaul">#</a></h2><p>Until now, Jest could only operate in one project at a time. This is often cumbersome if you are working on many smaller projects that each have their own setup and configuration. With Jest 20, we rewrote the test runner completely to run many projects at the same time within a single instance of Jest, for example if you are working on a React frontend and a node.js backend. Here is a video of Jest running tests for <a href="https://github.com/facebook/react" target="_blank">React</a>, <a href="https://github.com/facebook/relay" target="_blank">Relay</a>, <a href="https://github.com/yarnpkg/yarn" target="_blank">Yarn</a> and Jest all at the same time:</p><p><img src="/jest/img/blog/20-multi-runner.gif" alt="multi-runner"/></p><div><!--truncate-->

</div><p>Jest is now collapsing the usage guide after the first test run to save vertical space in the terminal. Along with this, we also improved watch mode by adding arrow-key support to the test pattern typeaheads and the test file and test name pattern typeaheads now work together rather than being unrelated features which allow to select the right tests to run more easily:</p><p><img src="/jest/img/blog/20-typeahead.png" alt="typeahead"/></p><p>Further, we completely overhauled how the configuration system works inside of Jest. You can now pass any configuration option through the CLI to overwrite the ones specified in your configuration file. Along with that, we changed Jest to look for a <code>jest.config.js</code> file by default which means you are now able to define a Jest configuration using JavaScript as well as being able to configure it through <code>package.json</code> like before. Through the addition of all these new features, you are now able to combine Jest in more powerful ways than ever before. For example, if you would like to find out which tests Jest would run given a set of changed files from a commit across multiple projects in a monorepo, you can combine cli arguments like this now:</p><pre class="prism language-javascript">$ jest <span class="token operator">--</span>projects projectA projectB <span class="token operator">--</span>listTests <span class="token operator">--</span>findRelatedTests projectA<span class="token operator">/</span>banana<span class="token punctuation">.</span>js projectB<span class="token operator">/</span>kiwi<span class="token punctuation">.</span>js
<span class="token punctuation">[</span>
  <span class="token string">&quot;projectA/banana.test.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;projectB/kiwi.test.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;projectB/pineapple.test.js&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></pre><p>This is especially useful for continuous integration (CI) systems where you may want to only run a subset of tests for Pull Requests to prevent Jest from running thousands of test files on every small change.</p><p>Finally, we are now properly mapping code coverage when using TypeScript and we are running code coverage for untested files in worker processes which yields significant speed ups for this feature.</p><h2><a class="anchor" name="new-improved-testing-apis"></a>New &amp; Improved Testing APIs <a class="hash-link" href="#new-improved-testing-apis">#</a></h2><p>We made a number of additions and improvements to the testing APIs which will help write more effective tests. We&#x27;d like to point out that all of these improvements were made entirely by community members!</p><ul><li><strong>Better async testing:</strong> Added new async/Promise support through resolves/rejects modifiers on expect: <code>expect(Promise(…)).resolves.toEqual(…)</code>. <a href="https://facebook.github.io/jest/docs/en/expect.html#resolves" target="_blank">See documentation</a>.</li><li><strong>Expect &lt;n&gt; assertions:</strong> Along with the existing <code>expect.assertions(n)</code>, the new <code>expect.hasAssertions()</code> can be used to ensure a test has at least one assertion.</li><li><strong>Lint Plugin:</strong> A <code>valid-expect</code> rule was added to <code>eslint-plugin-jest</code> to ensure that an assertion is called after invoking <code>expect</code>. This will prevent mistakes like a stray <code>expect(banana);</code> with a missing assertion call.</li><li><strong>Pretty-Format Plugins:</strong> A number of new pretty-format plugins were added to Jest. We now pretty-print <a href="https://github.com/facebook/immutable-js/" target="_blank">Immutable.js</a> data structures and HtmlElements in assertion failures and snapshots.</li><li><strong>Custom Environment:</strong> It is now possible to add a <code>@jest-environment node|jsdom</code> annotation to the doc-block comment of a test file to use a test environment different from the default for individual tests.</li></ul><p>Here is an example of all how all the new APIs together will make testing more delightful:</p><pre class="prism language-javascript"><span spellcheck="true" class="token comment">/**
 * @jest-environment node
 */</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;compares apples and bananas&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token function">hasAssertions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// Ensure this test has at least one assertion.</span>

  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>Immutable<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>apples<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> bananas<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>Immutable<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>apples<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> bananas<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&#x27;banana&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// valid-expect in eslint-plugin-jest will show an error.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>This example will print a test failure similar to this:</p><p><img src="/jest/img/blog/20-testing-apis.png" alt="testing-apis"/></p><h2><a class="anchor" name="breaking-changes"></a>Breaking Changes <a class="hash-link" href="#breaking-changes">#</a></h2><p>As with every major release, we are making a number of breaking changes to make larger changes in the future possible and to push the testing experience to a new level. This time, we tried our best to only break APIs that we don&#x27;t expect to affect the majority of Jest&#x27;s users:</p><ul><li><strong>Fork of Jasmine 2.5:</strong> We finally decided to fork Jasmine itself and take ownership over Jest&#x27;s own test runner. This will allow us to improve all aspects of the unit testing experience in the future but for now we are focused on incremental rewrites and reducing the API surface. If you see a test breaking as a result of a Jasmine API that is now missing, there should be an equivalent feature on the <code>jest</code> or <code>expect</code> objects. As such, we have removed many Jasmine features that aren&#x27;t generally used in most codebases.</li><li><strong>New Snapshots on CI:</strong> Snapshots must always be committed along with the test and the modules they are testing. We changed Jest to not save new snapshots automatically in Continuous Integration (CI) environments or when the <code>--ci</code> flag is specified. To overwrite this behavior, which is generally not recommended, the <code>--updateSnapshot</code> flag can be used.</li><li><strong>Babel-Polyfill:</strong> Jest used to load <code>babel-polyfill</code> automatically when using babel-jest which resulted in memory leaks inside of Jest. In most versions of node, it is not necessary to load <code>babel-polyfill</code> so we removed this auto-inclusion and instead changed Jest to only include <code>regenerator-runtime</code> by default, which is commonly used to support async/await in older versions of Node.js. If you need <code>babel-polyfill</code>, you can manually require it in your setup files.</li></ul><h2><a class="anchor" name="other-improvements"></a>Other Improvements <a class="hash-link" href="#other-improvements">#</a></h2><ul><li><strong>Documentation:</strong> Documentation is critical to share best practices and teach everyone how to write effective tests which will lead to better software. Over the last few weeks we have also expanded Jest&#x27;s documentation to include a Snapshot Testing FAQ, a guide with information about how to use Jest with common JavaScript libraries as well as we documented the new features mentioned above.</li><li><strong>Translations:</strong> We are now asking for your help to <a href="https://crowdin.com/project/jest" target="_blank">translate the Jest documentation</a> to make it easier for people to learn how to use Jest.</li><li><strong>Custom Reporters:</strong> Jest now supports custom test reporters through the <code>reporters</code> configuration option. You can finally customize the output of Jest as well as integrate it with other tools by generating reports in formats such as XML. <a href="https://facebook.github.io/jest/docs/en/configuration.html#reporters-array-modulename-modulename-options" target="_blank">See documentation</a>.</li><li><strong>Codebase Health:</strong> It was only possible iterate so quickly in Jest because we spent a significant amount of time on the health of the codebase. We were one of the early adopters of <a href="https://github.com/prettier/prettier" target="_blank">prettier</a>, we notably increased flow coverage, forked Jasmine to improve our test runner library and we rewrote and refactored significant portions of Jest itself to set up Jest for success in the future.</li><li><strong>Bugfixes:</strong> As always, we made plenty of bugfixes in Jest. The full changelog can be found in the <a href="https://github.com/facebook/jest/blob/master/CHANGELOG.md#jest-2000" target="_blank">Jest repository</a>.</li></ul><h2><a class="anchor" name="talks-about-jest"></a>Talks about Jest <a class="hash-link" href="#talks-about-jest">#</a></h2><p>Recently the Jest core team and other contributors started to talk more about Jest and the experience of working on Jest at conferences:</p><ul><li>Rogelio Guzman did a talk about <a href="https://www.youtube.com/watch?time_continue=416&amp;v=HAuXJVI_bUs" target="_blank">Jest Snapshots and Beyond</a> at React Conf.</li><li>I spoke about <a href="https://developers.facebook.com/videos/f8-2017/building-high-quality-javascript-tools/" target="_blank">Building High-Quality JavaScript Tools</a> at Facebook&#x27;s F8 conference.</li></ul><p><em>As always, this release couldn&#x27;t have been possible without you, the JavaScript community. We are incredibly grateful that we get the opportunity to work on improving JavaScript testing together. If you&#x27;d like to contribute to Jest, please don&#x27;t hesitate to reach out to us on <a href="https://github.com/facebook/jest" target="_blank">GitHub</a> or on <a href="https://discordapp.com/channels/102860784329052160/103622435865104384" target="_blank">Discord</a>.</em></p></div></div></div><div class="blog-recent"><a class="button" href="/jest/blog">Recent Posts</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/jest" class="nav-home"><img src="/jest/img/jest-outline.svg" alt="Jest" width="66" height="58"/></a><div><h5>Docs</h5><a href="/jest/docs/en/getting-started.html">Getting Started</a><a href="/jest/docs/en/snapshot-testing.html">Guides</a><a href="/jest/docs/en/api.html">API Reference</a></div><div><h5>Community</h5><a href="/jest/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/jestjs" target="_blank">Stack Overflow</a><a href="https://discordapp.com/channels/102860784329052160/103622435865104384">Jest Chat</a><a href="https://twitter.com/fbjest" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/jest/blog">Blog</a><a href="https://github.com/facebook/jest">GitHub</a><a class="github-button" href="https://github.com/facebook/jest" data-icon="octicon-star" data-count-href="/facebook/jest/stargazers" data-count-api="/repos/facebook/jest#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star facebook/jest on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/jest/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2017 Facebook Inc.</section></footer></div><script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-17', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                apiKey: '833906d7486e4059359fa58823c4ef56',
                indexName: 'jest',
                inputSelector: '#search_input_react'
              });
            </script></body></html>