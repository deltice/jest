<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>Troubleshooting · Jest</title><meta name="viewport" content="width=device-width"/><meta property="og:title" content="Troubleshooting · Jest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/jest/index.html"/><meta property="og:description" content="おやおや、うまくいきませんか？Jestについての問題を解決するのにこのガイドをご利用下さい。"/><meta property="og:image" content="/jest/img/opengraph.png"/><link rel="shortcut icon" href="/jest/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="/jest/css/main.css"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img src="/jest/img/jest-outline.svg"/><h2>Jest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/ja/getting-started.html" target="_self">ドキュメント</a></li><li><a href="/jest/docs/ja/api.html" target="_self">API</a></li><li><a href="/jest/ja/help.html" target="_self">ヘルプ</a></li><li><a href="/jest/blog" target="_self">ブログ</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/jest/img/language.svg"/>日本語</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/jest/en">English</a></li><li><a href="/jest/es-ES">Español</a></li><li><a href="/jest/pt-BR">Português (Brasil)</a></li><li><a href="/jest/ru">Русский</a></li><li><a href="/jest/uk">Українська</a></li><li><a href="/jest/zh-Hans">简体中文</a></li><li><a href="https://crowdin.com/project/jest" target="_blank">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/facebook/jest" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/ja/getting-started.html#content">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/using-matchers.html#content">Using Matchers</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/asynchronous.html#content">Testing Asynchronous Code</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/setup-teardown.html#content">Setup and Teardown</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/mock-functions.html#content">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/more-resources.html#content">More Resources</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/ja/api.html#content">Globals</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/expect.html#content">Expect</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/mock-function-api.html#content">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/jest-object.html#content">The Jest Object</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/configuration.html#content">Configuring Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/cli.html#content">Jest CLI Options</a></li></ul></div><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/ja/snapshot-testing.html#content">スナップショットテスト</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/tutorial-react.html#content">Testing React Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/tutorial-react-native.html#content">Testing React Native Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/tutorial-async.html#content">An Async Example</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/timer-mocks.html#content">Timer Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/manual-mocks.html#content">Manual Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/webpack.html#content">Using with webpack</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/migration-guide.html#content">Migrating to Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ja/testing-frameworks.html#content">Testing other frameworks</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/docs/ja/troubleshooting.html#content">Troubleshooting</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/jest/ja" target="_blank">Translate this Doc</a><h1>Troubleshooting</h1></header><article><div><p>おやおや、うまくいきませんか？Jestについての問題を解決するのにこのガイドをご利用下さい。</p><h3><a class="anchor" name=""></a>理由は分からないがテストが失敗する <a class="hash-link" href="#">#</a></h3><p>Nodeに組み込まれているデバッグサポート機能を試してみて下さい。</p><blockquote><p>注意: Jestのデバッグサポート機能は <code>node debug</code>のみサポートしています。<code>node inspect</code>は現在挙がっている<a href="https://github.com/nodejs/node/issues/7593" target="_blank">nodejs/node#7583</a>のためにサポートしていません。 当該の問題が解決されるまで、 Node バージョン8.x系ではNodeを使ったデバッグは利用できません。詳細については <a href="https://github.com/facebook/jest/issues/1652" target="_blank">facebook/jest#1652</a>を参照して下さい。</p></blockquote><p><code>debugger;</code>宣言をテストの任意の箇所に記述し、プロジェクトのディレクトリで以下のコマンドを実行して下さい。</p><pre class="prism language-javascript">node <span class="token operator">--</span>debug<span class="token operator">-</span>brk <span class="token punctuation">.</span><span class="token regex">/node_modules/</span><span class="token punctuation">.</span>bin<span class="token operator">/</span>jest <span class="token operator">--</span>runInBand <span class="token punctuation">[</span>any other arguments here<span class="token punctuation">]</span>
or on Windows
node <span class="token operator">--</span>debug<span class="token operator">-</span>brk <span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>jest<span class="token operator">/</span>bin<span class="token operator">/</span>jest<span class="token punctuation">.</span>js <span class="token operator">--</span>runInBand <span class="token punctuation">[</span>any other arguments here<span class="token punctuation">]</span></pre><p>このコマンドでJestは外部からのデバッガと接続できる状態のNodeプロセス上で実行されます。プロセスはデバッガが接続されるまでポーズすることに注意して下さい。</p><p>例えば、ポーズされたプロセスに<a href="https://github.com/node-inspector/node-inspector" target="_blank">Node Inspector</a>デバッガを接続するには、まず(まだインストールしていない場合は)デバッガをインストールします:</p><pre class="prism language-javascript">npm install <span class="token operator">--</span>global node<span class="token operator">-</span>inspector</pre><p>それから単にデバッガを実行します:</p><pre class="prism language-javascript">node<span class="token operator">-</span>inspector</pre><p>デバッガはChromeで開けるリンクを出力します。 リンクを開くとChromeDeveloperToolsが表示されJestのCLIスクリプトの１行目にブレークポイントが設定されます(これは単に開発者ツールを開くための時間を設けて、その前にJestが実行されてしまうのを防ぐためのものです)。 次の実行に進むには画面の上部右側にある再生ボタンのようなボタンをクリックします。 <code>debugger</code> 宣言を含むテストをJestが実行した場合、実行はポーズされ現在いのスコープとコールスタックを調べることができます。</p><blockquote><p>注意: コマンドラインの<code>--runInBand</code> オプションは個々のテストに対してプロセスを生成するのではなく必ず同じプロセスでJestを実行します。 通常Jestはプロセスをまたいで並列にテストを実行しますが、同時に複数のプロセスをデバッグするのは困難だからです。</p></blockquote><p>Nodeによるデバッグについての詳細は<a href="https://nodejs.org/api/debugger.html" target="_blank">ここ</a>で確認できます。</p><h3><a class="anchor" name=""></a>キャッシュ関連の問題 <a class="hash-link" href="#">#</a></h3><p>Jestがコードを変換するスクリプトの変更や、babelのアップデートを認識できていませんか？</p><p><a href="/jest/docs/cli.html#cache" target=""><code>--no-cache</code></a>オプションを付けて再実行してみて下さい。 Jestはテスト実行の高速化のために変換されたモジュールファイルをキャッシュします。 独自のトランスパイラを使用している場合は、<code>getCacheKey</code>関数を追加することを検討して下さい:<a href="https://github.com/facebook/relay/blob/58cf36c73769690f0bbf90562707eadb062b029d/scripts/jest/preprocessor.js#L56-L61" target="_blank">getCacheKey in Relay</a>。</p><h3><a class="anchor" name="promise"></a>Promiseが解決されない <a class="hash-link" href="#promise">#</a></h3><p>promiseが全く解決されない場合、このエラーが投げられるでしょう:</p><pre class="prism language-javascript"><span class="token operator">-</span> Error<span class="token punctuation">:</span> Timeout <span class="token operator">-</span> Async callback was not invoked within timeout specified by jasmine<span class="token punctuation">.</span>DEFAULT_TIMEOUT_INTERVAL<span class="token punctuation">.</span>`</pre><p>最も多い原因はPromiseの実装が競合していることです。 グローバルなPromiseの実装を独自のものに置き換えます、例えば<code>global.Promise = require.requireActual(&#x27;promise&#x27;);</code>とします。そして(もしくは)使用しているPromiseのライブラリを１つだけに統合してみることを検討して下さい。</p><p>テストの実行が長時間かかる場合は、<code>jest.setTimeout</code>を呼び出してタイムアウト時間を伸ばすことも検討したくなるでしょう。</p><pre class="prism language-javascript">jest<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// 10 second timeout</span></pre><h3><a class="anchor" name="watchman"></a>Watchman関連の問題 <a class="hash-link" href="#watchman">#</a></h3><p>Jestを<a href="/jest/docs/cli.html#watchman" target=""><code>--no-watchman</code></a> オプション付きで実行するか 構成オプションで<code>watchman</code>を<code>false</code>に設定してみてください。</p><p><a href="https://facebook.github.io/watchman/docs/troubleshooting.html" target="_blank">watchman troubleshooting</a>も参照して下さい。</p><h3><a class="anchor" name="docker-ci"></a>Dockerおよび/またはCIサーバ上でテストが極端に遅くなる <a class="hash-link" href="#docker-ci">#</a></h3><p>大抵の場合、モダンな高速なSSDとマルチコアのコンピュータではJestはとても早く動作しますが、特定のセットアップ環境では遅いことがユーザにより <a href="https://github.com/facebook/jest/issues/1524#issuecomment-260246008" target="_blank">発見</a> <a href="https://github.com/facebook/jest/issues/1395" target="_blank">されて</a>います。</p><p><a href="https://github.com/facebook/jest/issues/1524#issuecomment-262366820" target="_blank">調べた結果</a>に基づいて、この問題を軽減してして最大５０％高速化する１つの方法は、テストを順番に実行することです。</p><p>これを実施するには<a href="/jest/docs/cli.html#runinband" target=""><code>--runInBand</code></a>オプションを指定してテストを同じスレッドで実行して下さい。</p><pre class="prism language-bash"><span spellcheck="true" class="token comment"># Using Jest CLI</span>
jest --runInBand

<span spellcheck="true" class="token comment"># Using npm test (e.g. with create-react-app)</span>
<span class="token function">npm</span> <span class="token function">test</span> -- --runInBand</pre><p>テスト実行時間を高速化するもう１つの案としてはTravis-CIのようなCIサーバでワーカーのプール数を最大<em>4</em>までに設定することです。 Travis-CIに特定すると、テストの実行時間を半分にできます。 注意: オープンソースプロジェクトで利用できるTravis-CIの <em>フリー</em>プランは２CPUコアまでしか割り当てられません。</p><pre class="prism language-bash"><span spellcheck="true" class="token comment"># Using Jest CLI</span>
jest --maxWorkers<span class="token operator">=</span>4

<span spellcheck="true" class="token comment"># Using npm test (e.g. with create-react-app)</span>
<span class="token function">npm</span> <span class="token function">test</span> -- --maxWorkers<span class="token operator">=</span>4</pre><h3><a class="anchor" name=""></a>自動モック機能を利用するとテストが遅くなる <a class="hash-link" href="#">#</a></h3><p>設定オプションで <a href="configuration.html#automock-boolean" target="_blank"><code>automock: true</code></a>とするかテストで大量の<a href="jest-object.html#jestmockmodulename-factory-options" target="_blank"><code>jest.mock(&#x27;my-module&#x27;)</code></a> を呼び出すかした場合、自動モック機能は大規模なプロジェクトでパフォーマンスの低下を引き起こすことがあります。 モジュールのより多くの依存関係を持つほど、Jestはよりモック化により多くの労力を必要とします。 このパフォーマンスの低下を大幅に抑えるものとしては<code>import</code> または <code>require</code>コールを常に実行されるモジュールの先頭から、下方の通常は実行されないモジュールの中へ移動させるようにコードを変換する処理を追加することです。 これによりテスト実行時にJestがロードしなければならないモジュールの数を大幅に減らすことができます。</p><p><code>import</code>宣言の変換には<a href="https://github.com/zertosh/babel-plugin-transform-inline-imports-commonjs" target="_blank">babel-plugin-transform-inline-imports-commonjs</a>が、 <code>require</code>宣言の変換には<code>babel-preset-fbjs</code>パッケージの一部である<a href="https://github.com/facebook/fbjs/blob/master/packages/babel-preset-fbjs/plugins/inline-requires.js" target="_blank">Facebook製の<code>inline-requires</code> babel プラグイン</a>を使用してください。</p><h3><a class="anchor" name="npm3-node-modules"></a>npm3使用時に node_modulesが正しくロードされない <a class="hash-link" href="#npm3-node-modules">#</a></h3><p><code>jest-cli</code> をバージョン <code>0.9.0</code>以上にアップグレードして下さい。</p><h3><a class="anchor" name="import-babel"></a>非モック化したimportしたモジュールはbabel使用時に動作しないのですか？ <a class="hash-link" href="#import-babel">#</a></h3><p><code>jest-cli</code> をバージョン <code>0.9.0</code>以上にアップグレードして下さい。</p><p>説明:</p><pre class="prism language-js">jest<span class="token punctuation">.</span><span class="token function">dontMock</span><span class="token punctuation">(</span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&#x27;./foo&#x27;</span><span class="token punctuation">;</span></pre><p>ES6では、import宣言は他の全ての記述の前に移動されます。</p><pre class="prism language-js"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">dontMock</span><span class="token punctuation">(</span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// Oops!</span></pre><p>Jestバージョン0.9.0では、新たに <code>jest.unmock</code>APIが追加されました。babelプラグインとともに、現在は <code>babel-jest</code>を使用した場合は正しく動作します。</p><pre class="prism language-js">jest<span class="token punctuation">.</span><span class="token function">unmock</span><span class="token punctuation">(</span><span class="token string">&#x27;./foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">// Use unmock!</span>

<span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&#x27;./foo&#x27;</span><span class="token punctuation">;</span>

<span spellcheck="true" class="token comment">// foo is not mocked!</span></pre><p>バベルのサポートを有効にする手順は <a href="/jest/docs/getting-started.html#using-babel" target="">Getting Started</a>ガイドを参照して下さい。</p><h3><a class="anchor" name="jest-090"></a>Jestをバージョン0.9.0にアップグレードするとテストが失敗するようになったのですが？ <a class="hash-link" href="#jest-090">#</a></h3><p>Jestは現在デフォルトでJasmine2を使用しています。Jasmineの <a href="http://jasmine.github.io/2.0/introduction.html" target="_blank">upgrade guide</a>を利用して簡単にJasmine１からJasmine2にアップグレードできます。</p><p>もしJasmine１を使い続けたいのなら、 <code>testRunner</code>構成オプションを <code>jasmine1</code>に設定するかコマンドラインオプションで <code>--testRunner=jasmine1</code> を指定して下さい。</p><h3><a class="anchor" name=""></a>互換性の問題 <a class="hash-link" href="#">#</a></h3><p>JestはNodeバージョン４で追加された機能を利用します。 Nodeの最新の安定版リリースにアップグレードすることをお勧めします。 最低限サポートされているバージョンは、<code>v4.0.0</code> です。 バージョン<code>0.x.x</code> 系はサポートされていません。</p><h3><a class="anchor" name=""></a>まだ解決しませんか？ <a class="hash-link" href="#">#</a></h3><p><a href="/jest/help.html" target=""> Help</a> を参照してください。</p></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="testing-frameworks.html#content">← 前</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/jest" class="nav-home"><img src="/jest/img/jest-outline.svg" alt="Jest" width="66" height="58"/></a><div><h5>Docs</h5><a href="/jest/docs/ja/getting-started.html">Getting Started</a><a href="/jest/docs/ja/snapshot-testing.html">Guides</a><a href="/jest/docs/ja/api.html">API Reference</a></div><div><h5>Community</h5><a href="/jest/ja/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/jestjs" target="_blank">Stack Overflow</a><a href="https://discordapp.com/channels/102860784329052160/103622435865104384">Jest Chat</a><a href="https://twitter.com/fbjest" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/jest/blog">Blog</a><a href="https://github.com/facebook/jest">GitHub</a><a class="github-button" href="https://github.com/facebook/jest" data-icon="octicon-star" data-count-href="/facebook/jest/stargazers" data-count-api="/repos/facebook/jest#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star facebook/jest on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/jest/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2017 Facebook Inc.</section></footer></div><script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-17', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                apiKey: '833906d7486e4059359fa58823c4ef56',
                indexName: 'jest',
                inputSelector: '#search_input_react'
              });
            </script></body></html>