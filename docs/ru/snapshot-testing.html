<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>Тестирование при помощи снимков · Jest</title><meta name="viewport" content="width=device-width"/><meta property="og:title" content="Тестирование при помощи снимков · Jest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/jest/index.html"/><meta property="og:description" content="Тестирование с использованием снимков это очень полезный инструмент в ситуациях где вы хотите быть уверены, что ваш пользовательский интерфейс не изменяется неожиданным образом."/><meta property="og:image" content="/jest/img/opengraph.png"/><link rel="shortcut icon" href="/jest/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="/jest/css/main.css"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/jest/"><img src="/jest/img/jest-outline.svg"/><h2>Jest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/jest/docs/ru/getting-started.html" target="_self">Документация</a></li><li><a href="/jest/docs/ru/api.html" target="_self">API</a></li><li><a href="/jest/ru/help.html" target="_self">Справка</a></li><li><a href="/jest/blog" target="_self">Блог</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/jest/img/language.svg"/>Русский</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/jest/ja">日本語</a></li><li><a href="/jest/en">English</a></li><li><a href="/jest/es-ES">Español</a></li><li><a href="/jest/pt-BR">Português (Brasil)</a></li><li><a href="/jest/uk">Українська</a></li><li><a href="/jest/zh-Hans">简体中文</a></li><li><a href="https://crowdin.com/project/jest" target="_blank">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li><li><a href="https://github.com/facebook/jest" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/ru/getting-started.html#content">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/using-matchers.html#content">Using Matchers</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/asynchronous.html#content">Testing Asynchronous Code</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/setup-teardown.html#content">Setup and Teardown</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/mock-functions.html#content">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/more-resources.html#content">More Resources</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/jest/docs/ru/api.html#content">Globals</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/expect.html#content">Expect</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/mock-function-api.html#content">Mock Functions</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/jest-object.html#content">The Jest Object</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/configuration.html#content">Configuring Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/cli.html#content">Jest CLI Options</a></li></ul></div><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/jest/docs/ru/snapshot-testing.html#content">Тестирование при помощи снимков</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/tutorial-react.html#content">Testing React Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/tutorial-react-native.html#content">Testing React Native Apps</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/tutorial-async.html#content">An Async Example</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/timer-mocks.html#content">Timer Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/manual-mocks.html#content">Manual Mocks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/webpack.html#content">Using with webpack</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/migration-guide.html#content">Migrating to Jest</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/testing-frameworks.html#content">Testing other frameworks</a></li><li class="navListItem"><a class="navItem" href="/jest/docs/ru/troubleshooting.html#content">Troubleshooting</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/jest/ru" target="_blank">Translate this Doc</a><h1>Тестирование при помощи снимков</h1></header><article><div><p>Тестирование с использованием снимков это очень полезный инструмент в ситуациях где вы хотите быть уверены, что ваш пользовательский интерфейс не изменяется неожиданным образом.</p><p>Типичный тест снимка для мобильного приложения отображает элемент пользовательского интерфейса, совершает снимок экрана и затем сравнивает его со связанным изображением хранимым наряду с тестом. Тест провалится если два этих изображения не совпадают: либо изменение непредвиденно, либо снимок экрана нуждается в обновлении для совпадения с новой версией элемента интерфейса.</p><h2><a class="anchor" name="jest"></a>Тестирование с использованием снимков в Jest <a class="hash-link" href="#jest">#</a></h2><p>Похожий подход может быть использован, когда дело доходит до тестирования React компонентов. Вместо отображения графического пользовательского интерфейса, что потребует сборки всего приложения, разработчик может использовать специализированный модуль для генерации сериализуемого значения для конкретного React дерева. Consider this <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/link.react.test.js" target="_blank">example test</a> for a simple <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/Link.react.js" target="_blank">Link component</a>:</p><pre class="prism language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">&#x27;../Link.react&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> renderer <span class="token keyword">from</span> <span class="token string">&#x27;react-test-renderer&#x27;</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;отображается корректно&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;http://www.facebook.com&quot;</span><span class="token operator">&gt;</span>Facebook<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>The first time this test is run, Jest creates a <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/__snapshots__/link.react.test.js.snap" target="_blank">snapshot file</a> that looks like this:</p><pre class="prism language-javascript">exports<span class="token punctuation">[</span><span class="token template-string"><span class="token string">`отображается корректно 1`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
&lt;a
  className=&quot;normal&quot;
  href=&quot;http://www.facebook.com&quot;
  onMouseEnter={[Function]}
  onMouseLeave={[Function]}
&gt;
  Facebook
&lt;/a&gt;
`</span></span><span class="token punctuation">;</span></pre><p>Данный артефакт снимка следует занести в систему контроля версий наряду с изменениями в коде как часть вашего процесса по ревью кода. Jest использует <a href="https://github.com/facebook/jest/tree/master/packages/pretty-format" target="_blank">pretty-format</a> для того, чтобы сделать снимки подходящими для восприятия людьми во время процесса по ревью кода. При последующих запусках тестов Jest просто сравнит отображаемые выводом данные с предыдущим снимком. Если они совпадают, то тест успешно завершится. Если они не совпадают, то либо система тестирования обнаружила в вашем коде баг, который следует исправить, либо реализация изменилась и необходимо обновить снимок.</p><p>Более подробную информацию о том как тестирование с использованием снимков работает и почему мы ее реализовали можно найти в <a href="https://facebook.github.io/jest/blog/2016/07/27/jest-14.html" target="_blank">данной записи</a> нашего блога. Ме рекомендуем ознакомиться со <a href="http://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/" target="_blank">следующей записью</a>, чтобы получить хорошее представление о том, когда использовать тестирование с использованием снимков. We also recommend watching this <a href="https://egghead.io/lessons/javascript-use-jest-s-snapshot-testing-feature?pl=testing-javascript-with-jest-a36c4074" target="_blank">egghead video</a> on Snapshot Testing with Jest.</p><h3><a class="anchor" name=""></a>Обновление снимков <a class="hash-link" href="#">#</a></h3><p>Если был введен баг, то довольно просто обнаружить тест со снимком, который проваливается. Когда такое происходит, устраните проблему и убедитесь, что ваши тесты завершаются успешно. А теперь давайте поговорим о случае, когда тест проваливается по причине осознанных изменений в реализации.</p><p>Подобная ситуация може возникнуть если мы намеренно внесем изменения в адрес ссылки внутри компонента Link в нашем примере.</p><pre class="prism language-javascript"><span spellcheck="true" class="token comment">// Добавлен кейс с Link, указывающей на другой адрес</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;renders correctly&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;http://www.instagram.com&quot;</span><span class="token operator">&gt;</span>Instagram<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>В этом случае Jest выведет следующее сообщение:</p><p><img src="/jest/img/content/failedSnapshotTest.png" alt=""/></p><p>Так как мы только что изменили наш компонент так, чтобы он указывал на другой адрес, то разумно ожидать изменений в снимке этого компонента. Наш тест с использованием снимка проваливается потому, что текущий снимок более не совпадает с сохраненным.</p><p>Чтобы решить эту проблему, нам нужно будет обновить сохраненный снимок. Вы можете запустить Jest с флагом, который укажет на необходимость повторной генерации снимков:</p><pre class="prism language-javascript">jest <span class="token operator">--</span>updateSnapshot</pre><p>Не ждите и примените внесенные изменения, выполнив команду указанную выше. Вы также можете использовать эквивалентный односимвольный флаг <code>-u</code> для повторного создания снимков, если предпочитаете. Это создаст и сохранит новый снимок для всех проваливающихся тестов использующих снимки. Если бы существовали дополнительные проваливающиеся тесты ввиду непреднамеренных неполадок, нам бы понадобилось исправить неполадки перед обновлением снимков, чтобы избежать сохранения снимков с неполадками в поведении.</p><p>Если вы хотите ограничить то, какие снимки будут сохранены заново, вы можете указать дополнительный флаг <code>--testNamePatter</code> для сохранения снимков лишь для тех тестов, которые совпадают с указанным шаблоном.</p><p>Вы можете опробовать данный функционал клонировав <a href="https://github.com/facebook/jest/tree/master/examples/snapshot" target="_blank">пример снимка</a>, изменив компонент <code>Link</code> и запустив Jest.</p><h3><a class="anchor" name=""></a>Тесты должны быть детерминированными <a class="hash-link" href="#">#</a></h3><p>Ваши тесты должны быть детерминированными. То есть, запуск одних и тех же тестов множество раз для компонента, который не менялся, должен возвращать одинаковые результаты каждый раз. Вы ответственны за убеждение в том, что сохраненные снимки не включают специфичные для платформы или любые другие недетерминированные данные.</p><p>Например если у вас есть компонент <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/Clock.react.js" target="_blank">Clock</a>, который использует <code>Date.now()</code>, то снимок сгенерированный для этого компонента будет разным каждый раз, когда вы запускаете тест. В этом случае мы можем <a href="/jest/docs/mock-functions.html" target=""> создать мок для метода Date.now()</a>, чтобы возвращать фиксированное значение при каждом запуске теста:</p><pre class="prism language-javascript">Date<span class="token punctuation">.</span>now <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1482363367071</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Теперь при каждом запуске теста, <code>Date.now()</code> будет постоянно возвращать значение <code>1482363367071</code>. Это приведет к тому, что для данного компонента будет создаваться один и тот же снимок независимо от того, когда тест запускается.</p><h3><a class="anchor" name="ci"></a>В среде непрерывной интеграции (CI) снимки не создаются автоматически <a class="hash-link" href="#ci">#</a></h3><p>Начиная с Jest 20 снимки не создаются автоматически, если Jest запущен на CI без явного указания флага <code>--updateSnapshot</code>. Ожидается, что снимки являются обязательной частью теста, выполняемого на CI, следовательно, если они отсутствуют, тест не должен проходить. Рекомендуется всегда включать снимки в коммит вместе с тестами и хранить в системе контроля версий.</p><h2><a class="anchor" name=""></a>Часто задаваемые вопросы <a class="hash-link" href="#">#</a></h2><h3><a class="anchor" name=""></a>Нужно ли коммитить файлы со снимками? <a class="hash-link" href="#">#</a></h3><p>Yes, all snapshot files should be committed alongside the modules they are covering and their tests. They should be considered as part of a test, similar to the value of any other assertion in Jest. In fact, snapshots represent the state of the source modules at any given point in time. In this way, when the source modules are modified, Jest can tell what changed from the previous version. It can also provide a lot of additional context during code review in which reviewers can study your changes better.</p><h3><a class="anchor" name="react"></a>Снимки работают только в тестах с React-компонентами? <a class="hash-link" href="#react">#</a></h3><p>Компоненты <a href="/jest/docs/tutorial-react.html" target="">React</a> и <a href="/jest/docs/tutorial-react-native.html" target="">React Native</a> – хорошие примеры того, где можно применять тесты со снимками. Однако, снимки могут содержать любые сериализуемые данные, и их всегда следует использовать, если цель теста – проверка корректности вывода. В репозитории Jest есть множество примеров тестирования вывода Jest, встроенной в него библиотеки assert&#x27;ов, а также логирования событий в различных частях кодовой базы Jest. See an example of <a href="https://github.com/facebook/jest/blob/master/integration_tests/__tests__/console.test.js" target="_blank">snapshotting CLI output</a> in the Jest repo.</p><h3><a class="anchor" name="what-s-the-difference-between-snapshot-testing-and-visual-regression-testing"></a>What&#x27;s the difference between snapshot testing and visual regression testing? <a class="hash-link" href="#what-s-the-difference-between-snapshot-testing-and-visual-regression-testing">#</a></h3><p>Snapshot testing and visual regression testing are two distinct ways of testing UIs, and they serve different purposes. Visual regression testing tools take screenshots of web pages and compare the resulting images pixel by pixel. With Snapshot testing values are serialized, stored within text files and compared using a diff algorithm. There are different trade-offs to consider and we listed the reasons why snapshot testing was built in the <a href="http://facebook.github.io/jest/blog/2016/07/27/jest-14.html#why-snapshot-testing" target="_blank">Jest blog</a>.</p><h3><a class="anchor" name="does-snapshot-testing-substitute-unit-testing"></a>Does snapshot testing substitute unit testing? <a class="hash-link" href="#does-snapshot-testing-substitute-unit-testing">#</a></h3><p>Snapshot testing is only one of more than 20 assertions that ship with Jest. The aim of snapshot testing is not to replace existing unit tests, but providing additional value and making testing painless. In some scenarios, snapshot testing can potentially remove the need for unit testing for a particular set of functionalities (e.g. React components), but they can work together as well.</p><h3><a class="anchor" name="what-is-the-performance-of-snapshot-testing-regarding-speed-and-size-of-the-generated-files"></a>What is the performance of snapshot testing regarding speed and size of the generated files? <a class="hash-link" href="#what-is-the-performance-of-snapshot-testing-regarding-speed-and-size-of-the-generated-files">#</a></h3><p>Jest has been rewritten with performance in mind, and snapshot testing is not an exception. Since snapshots are stored within text files, this way of testing is fast and reliable. Jest generates a new file for each test file that invokes the <code>toMatchSnapshot</code> matcher. The size of the snapshots is pretty small: For reference, the size of all snapshot files in the Jest codebase itself is less than 300 KB.</p><h3><a class="anchor" name="how-do-i-resolve-conflicts-within-snapshot-files"></a>How do I resolve conflicts within snapshot files? <a class="hash-link" href="#how-do-i-resolve-conflicts-within-snapshot-files">#</a></h3><p>Snapshot files must always represent the current state of the modules they are covering. Therefore, if you are merging two branches and encounter a conflict in the snapshot files, you can either resolve the conflict manually or to update the snapshot file by running Jest and inspecting the result.</p><h3><a class="anchor" name="is-it-possible-to-apply-test-driven-development-principles-with-snapshot-testing"></a>Is it possible to apply test-driven development principles with snapshot testing? <a class="hash-link" href="#is-it-possible-to-apply-test-driven-development-principles-with-snapshot-testing">#</a></h3><p>Although it is possible to write snapshot files manually, that is usually not approachable. Snapshots help figuring out whether the output of the modules covered by tests is changed, rather than giving guidance to design the code in the first place.</p><h3><a class="anchor" name="does-code-coverage-work-with-snapshots-testing"></a>Does code coverage work with snapshots testing? <a class="hash-link" href="#does-code-coverage-work-with-snapshots-testing">#</a></h3><p>Yes, just like with any other test.</p></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="cli.html#content">← Предыдущая</a><a class="docs-next button" href="tutorial-react.html#content">Next →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/jest" class="nav-home"><img src="/jest/img/jest-outline.svg" alt="Jest" width="66" height="58"/></a><div><h5>Docs</h5><a href="/jest/docs/ru/getting-started.html">Getting Started</a><a href="/jest/docs/ru/snapshot-testing.html">Guides</a><a href="/jest/docs/ru/api.html">API Reference</a></div><div><h5>Community</h5><a href="/jest/ru/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/jestjs" target="_blank">Stack Overflow</a><a href="https://discordapp.com/channels/102860784329052160/103622435865104384">Jest Chat</a><a href="https://twitter.com/fbjest" target="_blank">Twitter</a></div><div><h5>More</h5><a href="/jest/blog">Blog</a><a href="https://github.com/facebook/jest">GitHub</a><a class="github-button" href="https://github.com/facebook/jest" data-icon="octicon-star" data-count-href="/facebook/jest/stargazers" data-count-api="/repos/facebook/jest#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star facebook/jest on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/jest/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2017 Facebook Inc.</section></footer></div><script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-17', 'auto');
              ga('send', 'pageview');
            </script><script>
              var search = docsearch({
                apiKey: '833906d7486e4059359fa58823c4ef56',
                indexName: 'jest',
                inputSelector: '#search_input_react'
              });
            </script></body></html>